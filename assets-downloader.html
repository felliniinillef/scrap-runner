<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrap Runner - Загрузчик ресурсов</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #000033;
            color: #00ffff;
            margin: 0;
            padding: 20px;
        }
        
        h1, h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
        }
        
        .asset-section {
            margin-bottom: 30px;
        }
        
        .asset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .asset-card {
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ffff;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .asset-card:hover {
            background-color: #002233;
            transform: scale(1.05);
        }
        
        .asset-preview {
            width: 100%;
            height: 80px;
            background-color: #222;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .asset-preview.audio {
            font-size: 30px;
        }
        
        .asset-name {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .asset-size {
            font-size: 12px;
            color: #999;
        }
        
        .download-all {
            background-color: #00ffff;
            color: #000033;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s ease;
        }
        
        .download-all:hover {
            background-color: #00cccc;
            transform: scale(1.05);
        }
        
        .canvas-container {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Scrap Runner</h1>
        <h2>Загрузчик ресурсов</h2>
        
        <div class="asset-section">
            <h3>Изображения</h3>
            <div class="asset-grid" id="images-grid"></div>
        </div>
        
        <div class="asset-section">
            <h3>Звуки</h3>
            <div class="asset-grid" id="audio-grid"></div>
        </div>
        
        <button class="download-all" id="download-all">Скачать все ресурсы (ZIP)</button>
    </div>
    
    <div class="canvas-container" id="canvas-container"></div>
    
    <script>
        // Определение списка ресурсов
        const assets = {
            images: [
                { name: 'logo.png', width: 400, height: 200, description: 'Логотип игры' },
                { name: 'menu_background.png', width: 800, height: 600, description: 'Фон для меню' },
                { name: 'player.png', width: 32, height: 48, description: 'Спрайт игрока' },
                { name: 'player_run.png', width: 32, height: 48, description: 'Спрайт бега игрока' },
                { name: 'player_jump.png', width: 32, height: 48, description: 'Спрайт прыжка игрока' },
                { name: 'ground.png', width: 32, height: 32, description: 'Блок земли' },
                { name: 'resource.png', width: 24, height: 24, description: 'Иконка ресурса' },
                { name: 'button.png', width: 200, height: 50, description: 'Кнопка обычная' },
                { name: 'button_hover.png', width: 200, height: 50, description: 'Кнопка при наведении' },
                { name: 'placeholder.png', width: 64, height: 64, description: 'Изображение-заглушка' },
                { name: 'icon.png', width: 192, height: 192, description: 'Иконка приложения' },
            ],
            audio: [
                { name: 'menu_music.mp3', duration: '60', description: 'Музыка в меню' },
                { name: 'button_click.mp3', duration: '0.5', description: 'Звук клика' },
                { name: 'game_music.mp3', duration: '120', description: 'Музыка в игре' },
                { name: 'jump.mp3', duration: '0.5', description: 'Звук прыжка' },
                { name: 'collect.mp3', duration: '0.5', description: 'Звук сбора' }
            ]
        };
        
        // Функция для создания карточек ресурсов
        function createAssetCards() {
            const imagesGrid = document.getElementById('images-grid');
            const audioGrid = document.getElementById('audio-grid');
            
            // Добавляем изображения
            assets.images.forEach(asset => {
                const card = document.createElement('div');
                card.className = 'asset-card';
                card.dataset.type = 'image';
                card.dataset.name = asset.name;
                
                const preview = document.createElement('div');
                preview.className = 'asset-preview';
                preview.style.position = 'relative';
                
                // Создаем canvas с оптимизацией для частых операций чтения
                const canvas = document.createElement('canvas');
                canvas.width = asset.width;
                canvas.height = asset.height;
                const ctx = canvas.getContext('2d', { willReadFrequently: true });

                // Рисуем превью в зависимости от типа
                if (asset.name === 'logo.png') {
                    // Логотип
                    ctx.fillStyle = '#000033';
                    ctx.fillRect(0, 0, asset.width, asset.height);
                    
                    ctx.strokeStyle = '#00ffff';
                    ctx.lineWidth = 5;
                    ctx.strokeRect(10, 10, asset.width - 20, asset.height - 20);
                    
                    ctx.fillStyle = '#00ffff';
                    ctx.font = `bold ${Math.floor(asset.height/4)}px "Courier New"`;
                    ctx.textAlign = 'center';
                    ctx.fillText('SCRAP', asset.width/2, asset.height/3);
                    ctx.fillText('RUNNER', asset.width/2, asset.height*2/3);
                } 
                else if (asset.name === 'menu_background.png') {
                    // Фон меню
                    const gradient = ctx.createLinearGradient(0, 0, 0, asset.height);
                    gradient.addColorStop(0, '#000022');
                    gradient.addColorStop(1, '#000044');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, asset.width, asset.height);
                    
                    ctx.strokeStyle = '#00ffff';
                    ctx.globalAlpha = 0.2;
                    for (let y = 0; y < asset.height; y += 20) {
                        ctx.beginPath();
                        ctx.moveTo(0, y);
                        ctx.lineTo(asset.width, y);
                        ctx.stroke();
                    }
                    
                    for (let x = 0; x < asset.width; x += 20) {
                        ctx.beginPath();
                        ctx.moveTo(x, 0);
                        ctx.lineTo(x, asset.height);
                        ctx.stroke();
                    }
                    ctx.globalAlpha = 1;
                }
                else if (asset.name === 'player.png') {
                    // Спрайт игрока
                    ctx.fillStyle = '#00ffff';
                    ctx.fillRect(0, 0, asset.width, asset.height);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(4, 4, asset.width - 8, asset.height/3);
                    
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(asset.width/3, asset.height/5, asset.width/6, asset.height/10);
                    ctx.fillRect(asset.width*2/3 - asset.width/6, asset.height/5, asset.width/6, asset.height/10);
                }
                else if (asset.name === 'player_run.png' || asset.name === 'player_jump.png') {
                    const frameWidth = asset.width;
                    const frameHeight = asset.height;
                    const numFrames = 6;  // 6 frames for smooth animation
                    const spriteSheetWidth = frameWidth * numFrames;
                    
                    // Resize canvas to accommodate all frames
                    canvas.width = spriteSheetWidth;
                    canvas.height = frameHeight;
                    
                    // Reset context
                    ctx.clearRect(0, 0, spriteSheetWidth, frameHeight);
                    
                    // Base background color
                    ctx.fillStyle = '#2C3E50';  // Dark gray background
                    ctx.fillRect(0, 0, spriteSheetWidth, frameHeight);
                    
                    // Character color based on sprite type
                    const characterColor = asset.name === 'player_run.png' ? '#3498DB' : '#E74C3C';
                    ctx.fillStyle = characterColor;
                    
                    // Generate frames
                    for (let frame = 0; frame < numFrames; frame++) {
                        const frameX = frame * frameWidth;
                        
                        // Body
                        ctx.fillRect(
                            frameX + frameWidth/4, 
                            frameHeight/3, 
                            frameWidth/2, 
                            frameHeight/2
                        );
                        
                        // Head
                        ctx.beginPath();
                        ctx.arc(
                            frameX + frameWidth/2, 
                            frameHeight/4, 
                            frameWidth/6, 
                            0, 
                            Math.PI * 2
                        );
                        ctx.fill();
                        
                        // Animation variations
                        ctx.strokeStyle = '#FFFFFF';
                        ctx.lineWidth = 2;
                        
                        if (asset.name === 'player_run.png') {
                            // Running animation: leg movement
                            const legOffset = Math.sin(frame * Math.PI / 3) * (frameWidth/8);
                            ctx.beginPath();
                            ctx.moveTo(frameX + frameWidth/3 + legOffset, frameHeight*2/3);
                            ctx.lineTo(frameX + frameWidth/4 + legOffset, frameHeight);
                            ctx.moveTo(frameX + frameWidth*2/3 - legOffset, frameHeight*2/3);
                            ctx.lineTo(frameX + frameWidth*3/4 - legOffset, frameHeight);
                            ctx.stroke();
                        } else {
                            // Jumping animation: spread arms and legs
                            const armSpread = frame * (frameWidth/12);
                            ctx.beginPath();
                            ctx.moveTo(frameX + frameWidth/2 - armSpread, frameHeight/2);
                            ctx.lineTo(frameX + frameWidth/4, frameHeight*2/3);
                            ctx.moveTo(frameX + frameWidth/2 + armSpread, frameHeight/2);
                            ctx.lineTo(frameX + frameWidth*3/4, frameHeight*2/3);
                            ctx.stroke();
                        }
                    }
                }
                else if (asset.name === 'ground.png') {
                    // Земля
                    ctx.fillStyle = '#555555';
                    ctx.fillRect(0, 0, asset.width, asset.height);
                    
                    ctx.strokeStyle = '#333333';
                    for (let y = asset.height/4; y < asset.height; y += asset.height/4) {
                        ctx.beginPath();
                        ctx.moveTo(0, y);
                        ctx.lineTo(asset.width, y);
                        ctx.stroke();
                    }
                }
                else if (asset.name === 'resource.png') {
                    // Ресурс
                    ctx.fillStyle = '#aaaaaa';
                    ctx.beginPath();
                    ctx.arc(asset.width/2, asset.height/2, asset.width/2 - 2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#000000';
                    ctx.beginPath();
                    ctx.arc(asset.width/2, asset.height/2, asset.width/6, 0, Math.PI * 2);
                    ctx.fill();
                }
                else if (asset.name === 'button.png') {
                    // Кнопка
                    ctx.fillStyle = '#003333';
                    ctx.fillRect(0, 0, asset.width, asset.height);
                    
                    ctx.strokeStyle = '#00ffff';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(2, 2, asset.width - 4, asset.height - 4);
                }
                else if (asset.name === 'button_hover.png') {
                    // Кнопка при наведении
                    ctx.fillStyle = '#004444';
                    ctx.fillRect(0, 0, asset.width, asset.height);
                    
                    ctx.strokeStyle = '#00ffff';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(2, 2, asset.width - 4, asset.height - 4);
                }
                else if (asset.name === 'placeholder.png') {
                    // Заглушка
                    ctx.fillStyle = '#222222';
                    ctx.fillRect(0, 0, asset.width, asset.height);
                    
                    ctx.strokeStyle = '#ff0000';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(10, 10);
                    ctx.lineTo(asset.width - 10, asset.height - 10);
                    ctx.moveTo(asset.width - 10, 10);
                    ctx.lineTo(10, asset.height - 10);
                    ctx.stroke();
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('MISSING', asset.width/2, asset.height/2);
                    ctx.fillText('ASSET', asset.width/2, asset.height/2 + 12);
                }
                else if (asset.name === 'icon.png') {
                    // Create a detailed game icon
                    canvas.width = asset.width;
                    canvas.height = asset.height;
                    
                    // Background gradient
                    const gradient = ctx.createLinearGradient(0, 0, asset.width, asset.height);
                    gradient.addColorStop(0, '#000033');
                    gradient.addColorStop(1, '#000066');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, asset.width, asset.height);
                    
                    // Stylized scrap/robot element
                    ctx.fillStyle = '#00FFFF';  // Cyan color
                    
                    // Body
                    ctx.beginPath();
                    ctx.moveTo(asset.width/4, asset.height*2/3);
                    ctx.lineTo(asset.width*3/4, asset.height*2/3);
                    ctx.lineTo(asset.width*2/3, asset.height);
                    ctx.lineTo(asset.width/3, asset.height);
                    ctx.closePath();
                    ctx.fill();
                    
                    // Head
                    ctx.beginPath();
                    ctx.arc(asset.width/2, asset.height/3, asset.width/5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Eyes
                    ctx.fillStyle = '#000000';
                    ctx.beginPath();
                    ctx.arc(asset.width*2/5, asset.height/3, asset.width/20, 0, Math.PI * 2);
                    ctx.arc(asset.width*3/5, asset.height/3, asset.width/20, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Highlight
                    ctx.strokeStyle = 'rgba(255,255,255,0.3)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(asset.width/4, asset.height/4);
                    ctx.lineTo(asset.width*3/4, asset.height*3/4);
                    ctx.stroke();
                }
                
                // Уменьшаем canvas до размера превью
                const img = document.createElement('img');
                img.src = canvas.toDataURL();
                img.style.maxWidth = '100%';
                img.style.maxHeight = '100%';
                preview.appendChild(img);
                
                // Добавляем информацию
                const name = document.createElement('div');
                name.className = 'asset-name';
                name.textContent = asset.name;
                
                const size = document.createElement('div');
                size.className = 'asset-size';
                size.textContent = `${asset.width}x${asset.height}`;
                
                card.appendChild(preview);
                card.appendChild(name);
                card.appendChild(size);
                
                // Обработчик скачивания
                card.addEventListener('click', () => {
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL('image/png');
                    link.download = asset.name;
                    link.click();
                });
                
                imagesGrid.appendChild(card);
            });
            
            // Добавляем аудио
            assets.audio.forEach(asset => {
                const card = document.createElement('div');
                card.className = 'asset-card';
                card.dataset.type = 'audio';
                card.dataset.name = asset.name;
                
                const preview = document.createElement('div');
                preview.className = 'asset-preview audio';
                preview.innerHTML = '🔊';
                
                const name = document.createElement('div');
                name.className = 'asset-name';
                name.textContent = asset.name;
                
                const size = document.createElement('div');
                size.className = 'asset-size';
                size.textContent = `${asset.duration}сек`;
                
                card.appendChild(preview);
                card.appendChild(name);
                card.appendChild(size);
                
                // Обработчик скачивания
                card.addEventListener('click', () => {
                    // Создаем пустой аудиобуфер
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    const audioContext = new AudioContext();
                    
                    // Длительность зависит от типа
                    const duration = parseFloat(asset.duration);
                    const sampleRate = 44100;
                    const buffer = audioContext.createBuffer(
                        2, 
                        Math.floor(sampleRate * duration), 
                        sampleRate
                    );
                    
                    // Если это звук клика, добавляем небольшой щелчок
                    if (asset.name === 'button_click.mp3' || asset.name === 'collect.mp3' || asset.name === 'jump.mp3') {
                        const channelData = buffer.getChannelData(0);
                        for (let i = 0; i < 2000; i++) {
                            channelData[i] = Math.sin(i * 0.1) * (1 - i / 2000);
                        }
                    }
                    
                    // Если это игровая музыка, создаем более сложный звуковой паттерн
                    if (asset.name === 'game_music.mp3') {
                        const channelData0 = buffer.getChannelData(0);
                        const channelData1 = buffer.getChannelData(1);
                        
                        for (let i = 0; i < channelData0.length; i++) {
                            const time = i / sampleRate;
                            
                            // Создаем более сложную звуковую композицию
                            const freq1 = 220 * Math.sin(2 * Math.PI * 0.5 * time);
                            const freq2 = 440 * Math.sin(2 * Math.PI * 0.25 * time);
                            const freq3 = 660 * Math.sin(2 * Math.PI * 0.125 * time);
                            const freq4 = 880 * Math.sin(2 * Math.PI * 0.0625 * time);
                            
                            // Огибающая с затуханием
                            const envelope = Math.max(0, 1 - time / duration);
                            
                            // Смешивание частот с разными весами
                            channelData0[i] = envelope * (
                                freq1 * 0.3 + 
                                freq2 * 0.2 + 
                                freq3 * 0.1 + 
                                freq4 * 0.05
                            );
                            
                            channelData1[i] = envelope * (
                                freq1 * 0.2 + 
                                freq2 * 0.3 + 
                                freq3 * 0.2 + 
                                freq4 * 0.1
                            );
                        }
                    }
                    
                    // Создаем источник из буфера
                    const source = audioContext.createBufferSource();
                    source.buffer = buffer;
                    
                    // Создаем MediaStreamDestination для сохранения
                    const dest = audioContext.createMediaStreamDestination();
                    source.connect(dest);
                    
                    // Создаем MediaRecorder
                    const mediaRecorder = new MediaRecorder(dest.stream);
                    const chunks = [];
                    
                    mediaRecorder.ondataavailable = function(evt) {
                        chunks.push(evt.data);
                    };
                    
                    mediaRecorder.onstop = function() {
                        const blob = new Blob(chunks, { type: 'audio/mp3' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = asset.name;
                        a.click();
                        
                        setTimeout(function() {
                            URL.revokeObjectURL(url);
                        }, 100);
                    };
                    
                    // Начинаем запись
                    mediaRecorder.start();
                    
                    // Запускаем источник
                    source.start();
                    
                    // Останавливаем запись через указанное время
                    setTimeout(function() {
                        source.stop();
                        mediaRecorder.stop();
                    }, duration * 1000);
                });
                
                audioGrid.appendChild(card);
            });
        }
        
        // Инициализация страницы
        document.addEventListener('DOMContentLoaded', function() {
            createAssetCards();
            
            // Обработчик для кнопки "Скачать все"
            document.getElementById('download-all').addEventListener('click', function() {
                alert('Эта функция будет доступна в следующей версии. Пожалуйста, скачайте ресурсы по одному.');
            });
        });
    </script>
</body>
</html>
